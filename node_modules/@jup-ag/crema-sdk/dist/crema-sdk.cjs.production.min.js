"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("decimal.js"),n=e(t),r=e(require("tiny-invariant")),i=require("@solana/buffer-layout"),o=require("@solana/web3.js"),a=e(require("bn.js")),u=require("@solana/spl-token");function s(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){s(o,r,i,a,u,"next",e)}function u(e){s(o,r,i,a,u,"throw",e)}a(void 0)}))}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,d=(function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var i=Object.create((t&&t.prototype instanceof p?t:p).prototype),o=new T(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=g(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=c(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(e,n,o),i}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var l={};function p(){}function f(){}function d(){}var h={};u(h,i,(function(){return this}));var y=Object.getPrototypeOf,w=y&&y(y(I([])));w&&w!==t&&n.call(w,i)&&(h=w);var m=d.prototype=p.prototype=Object.create(h);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,u){var s=c(e[i],e,o);if("throw"!==s.type){var l=s.arg,p=l.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,a,u)}),(function(e){r("throw",e,a,u)})):t.resolve(p).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,u)}))}u(s.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function g(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,g(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function v(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(v,this),this.reset(!0)}function I(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=d,u(m,"constructor",d),u(d,"constructor",f),f.displayName=u(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,u(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},k(b.prototype),u(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new b(s(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(m),u(m,a,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:I(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(f={exports:{}}),f.exports);n.config({precision:64,rounding:n.ROUND_DOWN,toExpNeg:-64,toExpPos:64});var h,y=new n(10),w=new n(2).pow(64),m=w.div(2).sub(1),k=w.div(2).neg(),b=w.sub(1),g=w.pow(63).sub(1),v=g.neg(),S=w.pow(64).sub(1),T=function(){function e(){}return e.from64Buffer=function(e,t){if(void 0===t&&(t=0),8!==e.length&&r(!1),Math.abs(t)<40||r(!1),e[7]>=128){for(var i,o=[],u=p(e);!(i=u()).done;)o.push(("00"+Math.abs(255&~i.value).toString(16)).slice(-2));var s=new a(o.join(""),16,"le").add(new a(1)).neg();return new n(s.toString()).div(y.pow(t))}return new n(new a(e,"le").toString()).div(y.pow(t))},e.fromU64Buffer=function(e,t){return void 0===t&&(t=0),8!==e.length&&r(!1),Math.abs(t)<40||r(!1),new n(new a(e,16,"le").toString()).div(y.pow(t))},e.from128Buffer=function(e,t){if(void 0===t&&(t=0),16!==e.length&&r(!1),Math.abs(t)<40||r(!1),e[15]>=128){for(var i,o=[],u=p(e);!(i=u()).done;)o.push(("00"+Math.abs(255&~i.value).toString(16)).slice(-2));var s=new a(o.join(""),16,"le").add(new a(1)).neg();return new n(s.toString()).div(y.pow(t))}return new n(new a(e,"le").toString()).div(y.pow(t))},e.fromU128Buffer=function(e,t){return void 0===t&&(t=0),16!==e.length&&r(!1),Math.abs(t)<40||r(!1),new n(new a(e,"le").toString()).div(y.pow(t))},e.to64Buffer=function(e,t){void 0===t&&(t=0),Math.abs(t)<40||r(!1),(e=e.mul(y.pow(t)).round()).greaterThanOrEqualTo(k)&&e.lessThanOrEqualTo(m)||r(!1);var n=new a(e.toString());if(n.isNeg()){var i=n.add(new a(1)).toBuffer("le",8);return i.forEach((function(e,t,n){n[t]=255&~e})),i}return n.toBuffer("le",8)},e.toU64Buffer=function(e,t){return void 0===t&&(t=0),Math.abs(t)<40||r(!1),(e=e.mul(y.pow(t)).round()).greaterThanOrEqualTo(0)&&e.lessThanOrEqualTo(b)||r(!1),new a(e.toString()).toBuffer("le",8)},e.to128Buffer=function(e,t){void 0===t&&(t=0),Math.abs(t)<40||r(!1),(e=e.mul(y.pow(t)).round()).greaterThanOrEqualTo(v)&&e.lessThanOrEqualTo(g)||r(!1);var n=new a(e.toString());if(n.isNeg()){var i=n.add(new a(1)).toBuffer("le",16);return i.forEach((function(e,t,n){n[t]=255&~e})),i}return n.toBuffer("le",16)},e.toU128Buffer=function(e,t){return void 0===t&&(t=0),Math.abs(t)<40||r(!1),(e=e.mul(y.pow(t)).round()).greaterThanOrEqualTo(0)&&e.lessThanOrEqualTo(S)||r(!1),new a(e.toString()).toBuffer("le",16)},e}(),I=function(e){return{decode:e.decode.bind(e),encode:e.encode.bind(e)}},A=function(e){void 0===e&&(e="publicKey");var t=i.blob(32,e),n=I(t),r=n.encode,a=n.decode,u=t;return u.decode=function(e,t){var n=a(e,t);return new o.PublicKey(n)},u.encode=function(e,t,n){var i=e.toBuffer();return r(i,t,n)},u},x=function(e,t){void 0===e&&(e="uint64"),void 0===t&&(t=0);var n=i.blob(8,e),r=n.decode.bind(n),o=n.encode.bind(n),a=n;return a.decode=function(e,n){var i=Buffer.from(r(e,n));return T.fromU64Buffer(i,t)},a.encode=function(e,n,r){var i=T.toU64Buffer(e,t);return o(i,n,r)},a},P=function(e,t){void 0===e&&(e="uint64"),void 0===t&&(t=0);var n=i.blob(16,e),r=n.decode.bind(n),o=n.encode.bind(n),a=n;return a.decode=function(e,n){var i=Buffer.from(r(e,n));return T.from128Buffer(i,t)},a.encode=function(e,n,r){var i=T.to128Buffer(e,t);return o(i,n,r)},a},O=function(e,t){void 0===e&&(e="uint64"),void 0===t&&(t=0);var n=i.blob(16,e),r=n.decode.bind(n),o=n.encode.bind(n),a=n;return a.decode=function(e,n){var i=Buffer.from(r(e,n));return T.fromU128Buffer(i,t)},a.encode=function(e,n,r){var i=T.toU128Buffer(e,t);return o(i,n,r)},a};function K(e,t){return B.apply(this,arguments)}function B(){return(B=c(d.mark((function e(t,n){var r,i,a,u=arguments;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=u.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=u[a];return e.abrupt("return",o.sendAndConfirmTransaction(t,n,i,{skipPreflight:!1,commitment:"recent",preflightCommitment:"recent"}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t){return q.apply(this,arguments)}function q(){return(q=c(d.mark((function e(t,n){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.Token.getAssociatedTokenAddress(u.ASSOCIATED_TOKEN_PROGRAM_ID,u.TOKEN_PROGRAM_ID,t,n,!0);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,n,r){return u.Token.createAssociatedTokenAccountInstruction(u.ASSOCIATED_TOKEN_PROGRAM_ID,u.TOKEN_PROGRAM_ID,e,t,n,r)}function _(){return(_=c(d.mark((function e(t,n){var i,o;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getAccountInfo(n);case 2:return null==(null==(i=e.sent)?void 0:i.data)&&r(!1),(o=W(i)).address=n,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return E.apply(this,arguments)}function E(){return(E=c(d.mark((function e(t,n){var i,o,a,s,c,l,p;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTokenAccountsByOwner(n,{programId:u.TOKEN_PROGRAM_ID});case 2:for(i=e.sent,o=[],a=0;a<i.value.length;a++)c=(s=i.value[a]).pubkey,null==(null==(l=s.account)?void 0:l.data)&&r(!1),(p=W(l)).address=c,o.push(p);return e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){null==(null==e?void 0:e.data)&&r(!1);var t=u.AccountLayout.decode(null==e?void 0:e.data);return t.mint=new o.PublicKey(t.mint),t.owner=new o.PublicKey(t.owner),t.amount=u.u64.fromBuffer(t.amount),0===t.delegateOption?(t.delegate=null,t.delegatedAmount=new u.u64(0)):(t.delegate=new o.PublicKey(t.delegate),t.delegatedAmount=u.u64.fromBuffer(t.delegatedAmount)),t.isInitialized=0!==t.state,t.isFrozen=2===t.state,1===t.isNativeOption?(t.rentExemptReserve=u.u64.fromBuffer(t.isNative),t.isNative=!0):(t.rentExemptReserve=null,t.isNative=!1),t.closeAuthority=0===t.closeAuthorityOption?null:new o.PublicKey(t.closeAuthority),t}!function(e){e[e.Initialize=0]="Initialize",e[e.Swap=1]="Swap",e[e.DepositAllTokenTypes=2]="DepositAllTokenTypes",e[e.WithdrawAllTokenTypes=3]="WithdrawAllTokenTypes",e[e.Claim=4]="Claim",e[e.ManagerClaim=5]="ManagerClaim",e[e.AddUserPosition=6]="AddUserPosition",e[e.UpdateFee=7]="UpdateFee",e[e.SimulateSwap=8]="SimulateSwap"}(h||(h={}));var G=i.struct([i.u8("instruction")]),R=i.struct([i.u8("instruction"),x("positionIndex")]),U=function(e,t,n,r,i,a,s,c,l,p,f,d,y){var w=Buffer.alloc(R.span);return R.encode({instruction:h.Claim,positionIndex:y},w),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:w})},M=i.struct([i.u8("instruction"),i.u8("isNewPosition"),O("liquityAmount"),i.s32("tickLower"),i.s32("tickUpper"),x("maximumTokenA"),x("maximumTokenB"),x("positionIndex")]),F=function(e,t,n,r,i,a,s,c,l,p,f,d,y,w,m,k,b,g,v){var S=Buffer.alloc(M.span);return M.encode({instruction:h.DepositAllTokenTypes,isNewPosition:y,liquityAmount:k,tickLower:w,tickUpper:m,maximumTokenA:b,maximumTokenB:g,positionIndex:v},S),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:S})},C=i.struct([i.u8("instruction"),i.u8("nonce"),i.u8("curveType"),x("fee",12),x("managerFee",12),i.u32("tickSpace"),O("currentSqrtPrice",12),O("currentLiquity"),O("feeGrowthGlobal0"),O("feeGrowthGlobal1"),O("managerFeeA"),O("managerFeeB")]),j=function(e,t,r,i,a,s,c,l,p,f,d,y,w,m,k,b){var g=Buffer.alloc(C.span);return C.encode({instruction:h.Initialize,nonce:d,curveType:y,fee:w,managerFee:m,tickSpace:k,currentSqrtPrice:b,currentLiquity:new n(0),feeGrowthGlobal0:new n(0),feeGrowthGlobal1:new n(0),managerFeeA:new n(0),managerFeeB:new n(0)},g),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:g})},z=i.struct([i.u8("instruction")]),V=function(e,t,n,r,i,a,s,c){var l=Buffer.alloc(z.span);return z.encode({instruction:h.ManagerClaim},l),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:l})},H=i.struct([i.u8("instruction"),x("amountIn"),x("minimumAmountOut")]),X=function(e,t,n,r,i,a,s,c,l,p,f){var d=Buffer.alloc(H.span);return H.encode({instruction:h.Swap,amountIn:p,minimumAmountOut:f},d),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:d})},Y=i.struct([i.u8("instruction"),x("liquityAmount"),x("minimumTokenA"),x("minimumTokenB"),x("positionIndex")]),Z=function(e,t,n,r,i,a,s,c,l,p,f,d,y,w,m,k){var b=Buffer.alloc(Y.span);return Y.encode({instruction:h.WithdrawAllTokenTypes,liquityAmount:y,minimumTokenA:w,minimumTokenB:m,positionIndex:k},b),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:b})},Q=i.struct([i.u8("instruction"),x("amountIn"),i.u8("direction")]),J=function(e,t,n,r,i){var a=Buffer.alloc(Q.span);return Q.encode({instruction:h.SimulateSwap,amountIn:r,direction:i},a),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0}],programId:e,data:a})},$=i.struct([i.s32("tick"),O("tickPrice",12),O("liquityGross"),P("liquityNet"),O("feeGrowthOutside0",16),O("feeGrowthOutside1",16)],"tickInfo"),ee=i.struct([i.u8("swapVersion"),A("tokenSwapKey"),i.u8("accountType"),i.s32("len"),i.blob(503962,"dataFlat")],"ticksAccount"),te=function(e){return 504e3===e.data.length},ne=function(e,t){if(te(t)){var n=Buffer.from(t.data),r=ee.decode(n),o=r.swapVersion,a=r.tokenSwapKey,u=r.accountType,s=r.len,c=r.dataFlat.slice(0,s*$.span);return{pubkey:e,info:t,data:{swapVersion:o,tokenSwapKey:a,accountType:u,len:s,ticks:i.seq($,s).decode(c)}}}},re=i.struct([A("nftTokenId"),i.s32("lowerTick"),i.s32("upperTick"),O("liquity"),O("feeGrowthInsideALast",16),O("feeGrowthInsideBLast",16),O("tokenAFee",16),O("tokenBFee",16)],"position"),ie=i.struct([i.u8("swapVersion"),A("tokenSwapKey"),i.u8("accountType"),i.s32("len"),i.blob(359962,"dataFlat")],"positionsAccount"),oe=Math.floor(359962/re.span),ae=function(e){return 36e4===e.data.length},ue=function(e,t){if(ae(t)){var n=Buffer.from(t.data),r=ie.decode(n),o=r.swapVersion,a=r.tokenSwapKey,u=r.accountType,s=r.len,c=r.dataFlat.slice(0,s*re.span);return{pubkey:e,info:t,data:{swapVersion:o,tokenSwapKey:a,accountType:u,len:s,positions:i.seq(re,s).decode(c)}}}},se=i.struct([A("tokenSwapKey"),i.u8("accountType"),i.u8("version"),i.u8("isInitialized"),i.u8("nonce"),A("tokenProgramId"),A("manager"),A("managerTokenA"),A("managerTokenB"),A("swapTokenA"),A("swapTokenB"),A("tokenAMint"),A("tokenBMint"),A("ticksKey"),A("positionsKey"),i.u8("curveType"),x("fee",12),x("managerFee",12),i.u32("tickSpace"),O("currentSqrtPrice",12),O("currentLiquity"),O("feeGrowthGlobal0",16),O("feeGrowthGlobal1",16),O("managerFeeA"),O("managerFeeB")],"tokenSwapAccount"),ce=se.span,le=function(e){return e.data.length===ce},pe=function(e,t){if(le(t)){var n=Buffer.from(t.data);return{pubkey:e,info:t,data:se.decode(n)}}},fe=new t.Decimal("1.0001"),de=new t.Decimal("1e-12"),he=fe.pow(443632),ye=fe.pow(-443632),we=fe.pow(221816),me=fe.pow(-221816);function ke(e){return e.lessThan(we)||r(!1),e.greaterThan(me)||r(!1),e.pow(2).log(fe).toDP(0,t.Decimal.ROUND_HALF_UP).toNumber()}function be(e){return e>=-443632&&e<=443632||r(!1),fe.pow(e/2)}function ge(e){return e.lessThan(he)||r(!1),e.greaterThan(ye)||r(!1),e.log(fe).toDP(0,t.Decimal.ROUND_HALF_UP).toNumber()}function ve(e,t){t>0&&t%1==0||r(!1),e.lessThan(we)||r(!1),e.greaterThan(me)||r(!1);var n=ke(e),i=(n- -443632)%t;return i>t/2?n-i+t:n-i}function Se(e,t){t>0&&t%1==0||r(!1),e.lessThan(he)||r(!1),e.greaterThan(ye)||r(!1);var n=ge(e),i=(n- -443632)%t;return i>t/2?n-i+t:n-i}function Te(e,n,i,o,a){a.greaterThan(new t.Decimal(0))||r(!1),o.greaterThanOrEqualTo(new t.Decimal(0))||r(!1),e.length>0||r(!1),n>e[0].tickPrice||r(!1);for(var u=o,s=new t.Decimal(0),c=a,l=new t.Decimal(0),p=new t.Decimal(0),f=new t.Decimal(0),d=e.length-1;d>=0;d--)if(u.equals(new t.Decimal(0)))n=e[d].tickPrice.sub(de),u=u.sub(e[d].liquityNet);else if(!(n<e[d].tickPrice)){var h=n,y=e[d].tickPrice,w=Ae(y,n,u),m=w.mul(i).toDP(0,t.Decimal.ROUND_DOWN);if(l=c.lessThan(m)?c:c.sub(m),w.greaterThanOrEqualTo(l)){var k=Pe(h,u,l=c.mul(new t.Decimal(1).sub(i)).toDP(0,t.Decimal.ROUND_UP)),b=k.amountOut,g=k.afterSqrtPrice;return f=f.add(c),p=p.add(c.sub(l)),{amountOut:s.add(b),amountUsed:f,feeUsed:p,afterPrice:g,afterLiquity:u}}c=l.sub(w),f=f.add(w).add(m),p=p.add(m),s=s.add(xe(y,h,u)),u=u.sub(e[d].liquityNet),n=e[d].tickPrice.sub(de)}return{amountOut:s,amountUsed:f,feeUsed:p,afterPrice:n,afterLiquity:u}}function Ie(e,n,i,o,a){a.greaterThan(new t.Decimal(0))||r(!1),o.greaterThanOrEqualTo(new t.Decimal(0))||r(!1),e.length>0||r(!1),n.lessThan(e[e.length-1].tickPrice)||r(!1);for(var u=o,s=new t.Decimal(0),c=a,l=new t.Decimal(0),p=new t.Decimal(0),f=new t.Decimal(0),d=0;d<e.length;d++)if(u.equals(new t.Decimal(0)))n=e[d].tickPrice.add(de),u=u.add(e[d].liquityNet);else if(!(n>e[d].tickPrice)){var h=e[d].tickPrice,y=xe(n,h,u),w=y.mul(i).toDP(0,t.Decimal.ROUND_DOWN);if(l=c.lessThan(w)?c:c.sub(w),y.greaterThanOrEqualTo(l)){var m=Oe(n,u,l=c.mul(new t.Decimal(1).sub(i)).toDP(0,t.Decimal.ROUND_UP)),k=m.amountOut,b=m.afterSqrtPrice;return p=p.add(c),f=f.add(c.sub(l)),{amountOut:s.add(k),feeUsed:f,amountUsed:p,afterPrice:b.pow(2),afterLiquity:u}}c=l.sub(y),p=p.add(y).add(w),f=f.add(w),s=s.add(Ae(n,h,u)),u=u.add(e[d].liquityNet),n=e[d].tickPrice.add(de)}return{amountOut:s,amountUsed:p,feeUsed:f,afterPrice:n,afterLiquity:u}}function Ae(e,n,r){return r.div(e).toDP(0,t.Decimal.ROUND_DOWN).sub(r.div(n).toDP(0,t.Decimal.ROUND_DOWN))}function xe(e,n,r){return r.mul(n.sub(e)).toDP(0,t.Decimal.ROUND_DOWN)}function Pe(e,n,r){var i=n.div(r.add(n.div(e))),o=r.add(n.div(e).toDP(0,t.Decimal.ROUND_DOWN));return{amountOut:n.mul(e).toDP(0,t.Decimal.ROUND_DOWN).sub(n.mul(n).div(o).toDP(0,t.Decimal.ROUND_DOWN)),afterSqrtPrice:i}}function Oe(e,n,r){var i=r.div(n).add(e),o=r.add(n.mul(e).toDP(0,t.Decimal.ROUND_DOWN));return{amountOut:n.div(e).toDP(0,t.Decimal.ROUND_DOWN).sub(n.mul(n).div(o).toDP(0,t.Decimal.ROUND_DOWN)),afterSqrtPrice:i}}function Ke(e,t,i,o,a){e<t||r(!1);var u=be(e),s=be(t);o.greaterThanOrEqualTo(u)&&o.lessThanOrEqualTo(s)||r(!1);var c=new n(1);if(0===a){var l=i.div(c.div(o).sub(c.div(s)));return{desiredAmountDst:l.mul(o.sub(u)),deltaLiquity:l}}var p=i.div(o.sub(u));return{desiredAmountDst:p.mul(c.div(o).sub(c.div(s))),deltaLiquity:p}}function Be(e,t,r,i){var o=be(e),a=be(t);return i.lessThan(o)?{amountA:r.div(o).sub(r.div(a)),amountB:new n(0)}:i.greaterThan(a)?{amountA:new n(0),amountB:r.mul(a).sub(r.mul(o))}:{amountA:r.div(i).sub(r.div(a)),amountB:r.mul(i).sub(r.mul(o))}}function De(e,t,i){e<t||r(!1);var o=be(e),a=be(t),u=new n(1);return i.div(u.div(o).sub(u.div(a)))}function qe(e,t,n){e<t||r(!1);var i=be(e),o=be(t);return n.div(o.sub(i))}var Ne=new o.PublicKey("11111111111111111111111111111111");n.config({precision:64,rounding:n.ROUND_HALF_DOWN,toExpNeg:-64,toExpPos:64});var _e=function(){function e(e,t,r,i){this.programId=Ne,this.tokenSwapKey=Ne,this.authority=Ne,this.isLoaded=!1,this.currentTick=0,this.tokenSwapInfo={tokenSwapKey:Ne,accountType:0,version:0,isInitialized:0,nonce:0,tokenProgramId:u.TOKEN_PROGRAM_ID,manager:Ne,managerTokenA:Ne,managerTokenB:Ne,swapTokenA:Ne,swapTokenB:Ne,tokenAMint:Ne,tokenBMint:Ne,ticksKey:Ne,positionsKey:Ne,curveType:0,fee:new n(0),managerFee:new n(0),tickSpace:0,currentSqrtPrice:new n(0),currentLiquity:new n(0),feeGrowthGlobal0:new n(0),feeGrowthGlobal1:new n(0),managerFeeA:new n(0),managerFeeB:new n(0)},this.ticks=[],this.conn=e,this.tokenSwapKey=r,this.programId=t,this.payer=i,this.positions=new Map,this.positionsKeys=new Map}var t=e.prototype;return t.setDefaultPayer=function(e){this.payer=e},t.load=function(){var e=c(d.mark((function e(){var t,i=this;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={encoding:"base64",filters:[{memcmp:{offset:1,bytes:this.tokenSwapKey.toBase58()}}]},e.next=3,this.conn.getProgramAccounts(this.programId,t);case 3:if(e.sent.map((function(e){if(le(e.account)){var t=pe(e.pubkey,e.account);void 0===(null==t?void 0:t.data)&&r(!1),i.tokenSwapInfo=t.data}else if(te(e.account)){var o=ne(e.pubkey,e.account);void 0===(null==o?void 0:o.data)&&r(!1),i.ticks=o.data.ticks}else if(ae(e.account)){var a=ue(e.pubkey,e.account);void 0===(null==a?void 0:a.data)&&r(!1),i.positionsKeys.set(e.pubkey,a.data.positions.length);for(var u=0;u<a.data.positions.length;u++){var s=a.data.positions[u];i.positions.set(s.nftTokenId.toBase58(),{positionsKey:e.pubkey,index:new n(u),positionId:s.nftTokenId,lowerTick:s.lowerTick,upperTick:s.upperTick,liquity:s.liquity,feeGrowthInsideALast:s.feeGrowthInsideALast,feeGrowthInsideBLast:s.feeGrowthInsideBLast,tokenAFee:s.tokenAFee,tokenBFee:s.tokenBFee})}}else console.log("the account:%s length:%d unkown",e.pubkey.toString(),e.account.data.length)})),this.authority.toString()!==Ne.toString()){e.next=11;break}return e.next=8,o.PublicKey.findProgramAddress([this.tokenSwapKey.toBuffer()],this.programId);case 8:this.authority=e.sent[0];case 11:return this.isLoaded=!0,this.currentTick=ke(this.tokenSwapInfo.currentSqrtPrice),e.abrupt("return",this);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e.createTokenSwap=function(){var t=c(d.mark((function t(n,r,i,a,s,c,l,p,f,h,y){var w,m,k,b,g,v,S,T,I,A,x,P,O,B,q,_,L;return d.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===y&&(y=!1),w=o.Keypair.generate(),m=o.Keypair.generate(),k=o.Keypair.generate(),t.next=6,o.PublicKey.findProgramAddress([w.publicKey.toBuffer()],r);case 6:return g=(b=t.sent)[0],v=b[1],t.next=11,n.getMinimumBalanceForRentExemption(504e3);case 11:return S=t.sent,t.next=14,n.getMinimumBalanceForRentExemption(36e4);case 14:return T=t.sent,t.next=17,n.getMinimumBalanceForRentExemption(ce);case 17:return I=t.sent,A=(new o.Transaction).add(o.SystemProgram.createAccount({fromPubkey:h.publicKey,newAccountPubkey:w.publicKey,lamports:I,space:ce,programId:r}),o.SystemProgram.createAccount({fromPubkey:h.publicKey,newAccountPubkey:m.publicKey,lamports:S,space:504e3,programId:r}),o.SystemProgram.createAccount({fromPubkey:h.publicKey,newAccountPubkey:k.publicKey,lamports:T,space:36e4,programId:r})),t.next=21,D(i,g);case 21:return x=t.sent,t.next=24,D(a,g);case 24:return P=t.sent,A.add(N(i,x,g,h.publicKey),N(a,P,g,h.publicKey)),O=f.sqrt(),B=new u.Token(n,i,u.TOKEN_PROGRAM_ID,h),q=new u.Token(n,a,u.TOKEN_PROGRAM_ID,h),t.next=31,B.getOrCreateAssociatedAccountInfo(s);case 31:return _=t.sent,t.next=34,q.getOrCreateAssociatedAccountInfo(s);case 34:return A.add(j(r,w.publicKey,g,s,_.address,t.sent.address,x,P,m.publicKey,k.publicKey,v,0,c,l,p,O)),t.next=39,K(n,A,h,w,m,k);case 39:return L=t.sent,y&&console.log(L),t.next=43,new e(n,r,w.publicKey,h).load();case 43:return t.abrupt("return",t.sent);case 44:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o,a,u,s,c,l,p){return t.apply(this,arguments)}}(),t.mintPosition=function(){var e=c(d.mark((function e(t,i,a,s,c,l,p,f,h){var y,w,m,k,b;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===h&&(h=null),!this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return a<s||r(!1),null==(h=null!=h?h:this.payer)&&r(!1),y=o.Keypair.generate(),e.next=10,D(y.publicKey,h.publicKey);case 10:return w=e.sent,e.next=13,u.Token.getMinBalanceRentForExemptAccount(this.conn);case 13:return m=e.sent,null==(k=this.choosePosition())&&r(!1),(b=new o.Transaction).add(o.SystemProgram.createAccount({fromPubkey:h.publicKey,newAccountPubkey:y.publicKey,lamports:m,space:u.MintLayout.span,programId:u.TOKEN_PROGRAM_ID}),u.Token.createInitMintInstruction(u.TOKEN_PROGRAM_ID,y.publicKey,0,this.authority,null),N(y.publicKey,w,h.publicKey,h.publicKey)),b.add(F(this.programId,this.tokenSwapKey,this.authority,f.publicKey,t,i,this.tokenSwapInfo.swapTokenA,this.tokenSwapInfo.swapTokenB,y.publicKey,w,this.tokenSwapInfo.ticksKey,k,0,a,s,c,l,p,new n(0))),e.next=21,K(this.conn,b,h,f,y);case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,u,s,c){return e.apply(this,arguments)}}(),t.increaseLiquity=function(){var e=c(d.mark((function e(t,n,i,a,s,c,l){var p,f,h,y;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===l&&(l=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return null==(p=this.getPositionInfo(t))&&r(!1),null===(l=null!=l?l:this.payer)&&r(!1),f=new u.Token(this.conn,t,u.TOKEN_PROGRAM_ID,l),e.t0=f,e.next=12,D(f.publicKey,l.publicKey);case 12:return e.t1=e.sent,e.next=15,e.t0.getAccountInfo.call(e.t0,e.t1);case 15:return 1!==(h=e.sent).amount.toNumber()&&r(!1),(y=new o.Transaction).add(F(this.programId,this.tokenSwapKey,this.authority,l.publicKey,n,i,this.tokenSwapInfo.swapTokenA,this.tokenSwapInfo.swapTokenB,t,h.address,this.tokenSwapInfo.ticksKey,p.positionsKey,1,p.lowerTick,p.upperTick,a,s,c,p.index)),e.next=21,K(this.conn,y,l);case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,u){return e.apply(this,arguments)}}(),t.decreaseLiquity=function(){var e=c(d.mark((function e(t,n,i,a,s,c,l){var p,f,h,y;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===l&&(l=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return null==(p=this.getPositionInfo(t))&&r(!1),null===(l=null!=l?l:this.payer)&&r(!1),f=new u.Token(this.conn,t,u.TOKEN_PROGRAM_ID,l),e.t0=f,e.next=12,D(f.publicKey,l.publicKey);case 12:return e.t1=e.sent,e.next=15,e.t0.getAccountInfo.call(e.t0,e.t1);case 15:return 1!==(h=e.sent).amount.toNumber()&&r(!1),y=(new o.Transaction).add(Z(this.programId,this.tokenSwapKey,this.authority,l.publicKey,this.tokenSwapInfo.swapTokenA,this.tokenSwapInfo.swapTokenB,n,i,t,h.address,this.tokenSwapInfo.ticksKey,p.positionsKey,a,s,c,p.index)),e.next=20,K(this.conn,y,l);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,u){return e.apply(this,arguments)}}(),t.swap=function(){var e=c(d.mark((function e(t,n,i,a,u,s,c){var l,p,f,h;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===c&&(c=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return null===(c=null!=c?c:this.payer)&&r(!1),p=(l=1===i?{swapSrc:this.tokenSwapInfo.swapTokenA,swapDst:this.tokenSwapInfo.swapTokenB}:{swapSrc:this.tokenSwapInfo.swapTokenB,swapDst:this.tokenSwapInfo.swapTokenA}).swapSrc,f=l.swapDst,h=(new o.Transaction).add(X(this.programId,this.tokenSwapKey,this.authority,s.publicKey,t,n,p,f,this.tokenSwapInfo.ticksKey,a,u)),e.next=10,K(this.conn,h,c,s);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,u){return e.apply(this,arguments)}}(),t.simulateSwap=function(){var e=c(d.mark((function e(t,n,r){var i;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoaded){e.next=3;break}return e.next=3,this.load();case 3:return i=(new o.Transaction).add(J(this.programId,this.tokenSwapKey,this.tokenSwapInfo.ticksKey,t,n)),e.next=6,this.conn.simulateTransaction(i,[r]);case 6:console.log(e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.collect=function(){var e=c(d.mark((function e(t,n,i,a){var s,c,l,p;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===a&&(a=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return null==(s=this.getPositionInfo(t))&&r(!1),null===(a=null!=a?a:this.payer)&&r(!1),c=new u.Token(this.conn,t,u.TOKEN_PROGRAM_ID,a),e.t0=c,e.next=12,D(c.publicKey,a.publicKey);case 12:return e.t1=e.sent,e.next=15,e.t0.getAccountInfo.call(e.t0,e.t1);case 15:return 1!==(l=e.sent).amount.toNumber()&&r(!1),p=(new o.Transaction).add(U(this.programId,this.tokenSwapKey,this.authority,a.publicKey,this.tokenSwapInfo.swapTokenB,this.tokenSwapInfo.swapTokenB,n,i,t,l.address,this.tokenSwapInfo.ticksKey,s.positionsKey,s.index)),e.next=20,K(this.conn,p,a);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),t.managerCollect=function(){var e=c(d.mark((function e(t,n,i){var a;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===i&&(i=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return null===(i=null!=i?i:this.payer)&&r(!1),a=(new o.Transaction).add(V(this.programId,this.tokenSwapKey,this.authority,i.publicKey,this.tokenSwapInfo.swapTokenA,this.tokenSwapInfo.swapTokenB,t,n)),e.next=9,K(this.conn,a,i);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.addPositionsAccount=function(){var e=c(d.mark((function e(t){var n,i,a;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return null===(t=null!=t?t:this.payer)&&r(!1),n=o.Keypair.generate(),e.next=9,this.conn.getMinimumBalanceForRentExemption(36e4);case 9:return i=e.sent,a=(new o.Transaction).add(o.SystemProgram.createAccount({fromPubkey:t.publicKey,newAccountPubkey:n.publicKey,lamports:i,space:36e4,programId:this.programId}),(s=this.programId,c=this.authority,l=n.publicKey,p=Buffer.alloc(G.span),G.encode({instruction:h.AddUserPosition},p),new o.TransactionInstruction({keys:[{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:s,data:p}))),e.next=13,K(this.conn,a,t,n);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}var s,c,l,p}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.approve=function(){var e=c(d.mark((function e(t,n,i,o,a){var s;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===a&&(a=null),null===(a=null!=a?a:this.payer)&&r(!1),s=new u.Token(this.conn,n,u.TOKEN_PROGRAM_ID,a),e.next=6,s.approve(t,o.publicKey,a,[],i.toNumber());case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),t.getUserPositions=function(){var e=c(d.mark((function e(t){var n,i,o,a,u;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=void 0),this.isLoaded||r(!1),void 0===(t=null!=t?t:null==(n=this.payer)?void 0:n.publicKey)&&r(!1),e.next=6,L(this.conn,t);case 6:for(i=e.sent,o=[],a=0;a<i.length;a++)void 0!==(u=this.positions.get(i[a].mint.toBase58()))&&o.push(u);return e.abrupt("return",o);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.calculateLiquityByTokenA=function(e,t,i){if(this.isLoaded||r(!1),this.currentTick<=t||r(!1),this.currentTick<e)return{desiredAmountB:new n(0),liquity:De(e,t,i)};var o=Ke(e,t,i,this.tokenSwapInfo.currentSqrtPrice,0);return{desiredAmountB:o.desiredAmountDst,liquity:o.deltaLiquity}},t.calculateLiquityByTokenB=function(e,t,i){if(this.isLoaded||r(!1),this.currentTick>=e||r(!1),this.currentTick<t)return{desiredAmountA:new n(0),liquity:qe(e,t,i)};var o=Ke(e,t,i,this.tokenSwapInfo.currentSqrtPrice,1);return{desiredAmountA:o.desiredAmountDst,liquity:o.deltaLiquity}},t.calculatePositionValue=function(e){this.isLoaded||r(!1);var t=this.getPositionInfo(e);void 0===t&&r(!1);var n=Be(t.lowerTick,t.upperTick,t.liquity,this.tokenSwapInfo.currentSqrtPrice);return{liquity:t.liquity,amountA:n.amountA,amountB:n.amountB}},t.preCollect=function(e){this.isLoaded||r(!1);var t=this.getPositionInfo(e);void 0===t&&r(!1);for(var i=null,o=null,a=0;a<this.ticks.length;a++)this.ticks[a].tick==t.lowerTick&&(i=this.ticks[a]),this.ticks[a].tick==t.upperTick&&(o=this.ticks[a]);null===i&&r(!1),null===o&&r(!1);var u=new n(0),s=new n(0),c=new n(0),l=new n(0),p=this.tokenSwapInfo.currentSqrtPrice;return i.tickPrice.lessThan(p)?(u=i.feeGrowthOutside0,s=i.feeGrowthOutside1):(u=this.tokenSwapInfo.feeGrowthGlobal0.sub(i.feeGrowthOutside0),s=this.tokenSwapInfo.feeGrowthGlobal1.sub(i.feeGrowthOutside1)),o.tickPrice.lessThan(p)?(c=this.tokenSwapInfo.feeGrowthGlobal0.sub(o.feeGrowthOutside0),l=this.tokenSwapInfo.feeGrowthGlobal1.sub(o.feeGrowthOutside1)):(c=o.feeGrowthOutside0,l=o.feeGrowthOutside1),{amountA:this.tokenSwapInfo.feeGrowthGlobal0.sub(u).sub(c).sub(t.feeGrowthInsideALast).mul(t.liquity).add(t.tokenAFee),amountB:this.tokenSwapInfo.feeGrowthGlobal1.sub(s).sub(l).sub(t.feeGrowthInsideBLast).mul(t.liquity).add(t.tokenBFee)}},t.preSwapA=function(e){this.isLoaded||r(!1);var t=Te(this.ticks,this.tokenSwapInfo.currentSqrtPrice,this.tokenSwapInfo.fee,this.tokenSwapInfo.currentLiquity,e),i=this.tokenSwapInfo.currentSqrtPrice.pow(2),o=new n(1).div(i),a=t.amountOut.div(t.amountUsed),u=t.amountUsed.div(t.amountOut),s=a.sub(i).div(i).abs(),c=u.sub(o).div(o).abs(),l=t.afterPrice.pow(2),p=new n(1).div(l);return{amountOut:t.amountOut,amountUsed:t.amountUsed,feeUsed:t.feeUsed,afterPriceA:l,afterPriceB:p,afterLiquity:t.afterLiquity,impactA:s,impactB:c,transactionPriceA:a,transactionPriceB:u}},t.preSwapB=function(e){this.isLoaded||r(!1);var t=Ie(this.ticks,this.tokenSwapInfo.currentSqrtPrice,this.tokenSwapInfo.fee,this.tokenSwapInfo.currentLiquity,e),i=this.tokenSwapInfo.currentSqrtPrice.pow(2),o=new n(1).div(i),a=t.amountUsed.div(t.amountOut),u=t.amountOut.div(t.amountUsed),s=a.sub(i).div(i).abs(),c=u.sub(o).div(o).abs(),l=t.afterPrice.pow(2),p=new n(1).div(l);return{amountOut:t.amountOut,amountUsed:t.amountUsed,feeUsed:t.feeUsed,afterLiquity:t.afterLiquity,impactA:s,impactB:c,transactionPriceA:a,transactionPriceB:u,afterPriceA:l,afterPriceB:p}},t.getNearestTickByPrice=function(e){return this.isLoaded||r(!1),Se(e,this.tokenSwapInfo.tickSpace)},t.getPositionInfo=function(e){return this.isLoaded||r(!1),this.positions.get(e.toBase58())},t.choosePosition=function(){this.isLoaded||r(!1);for(var e,t=p(this.positionsKeys);!(e=t()).done;){var n=e.value;if(n[1]<oe)return n[0]}return null},t.log=function(){var e=null!==this.payer?this.payer.publicKey.toBase58():"null";console.log(JSON.stringify({programId:this.programId.toString(),tokenSwapKey:this.tokenSwapKey.toString(),payer:e,authority:this.authority.toString(),currentTick:this.currentTick,currentPrice:this.tokenSwapInfo.currentSqrtPrice.pow(2).toString(),tokenSwapInfo:{accountType:this.tokenSwapInfo.accountType,version:this.tokenSwapInfo.version,isInitialized:this.tokenSwapInfo.isInitialized,nonce:this.tokenSwapInfo.nonce,manager:this.tokenSwapInfo.manager.toString(),managerTokenA:this.tokenSwapInfo.managerTokenA.toString(),managerTokenB:this.tokenSwapInfo.managerTokenB.toString(),swapTokenA:this.tokenSwapInfo.swapTokenA.toString(),swapTokenB:this.tokenSwapInfo.swapTokenB.toString(),tokenAMint:this.tokenSwapInfo.tokenAMint.toString(),tokenBMint:this.tokenSwapInfo.tokenBMint.toString(),ticksKey:this.tokenSwapInfo.ticksKey.toString(),positionsKey:this.tokenSwapInfo.positionsKey.toString(),curveType:this.tokenSwapInfo.curveType,fee:this.tokenSwapInfo.fee,managerFee:this.tokenSwapInfo.managerFee,tickSpace:this.tokenSwapInfo.tickSpace,currentSqrtPrice:this.tokenSwapInfo.currentSqrtPrice,currentLiquity:this.tokenSwapInfo.currentLiquity,feeGrowthGlobal0:this.tokenSwapInfo.feeGrowthGlobal0,feeGrowthGlobal1:this.tokenSwapInfo.feeGrowthGlobal1,managerFeeA:this.tokenSwapInfo.managerFeeA,managerFeeB:this.tokenSwapInfo.managerFeeB},positions:Object.fromEntries(this.positions),positionsKeys:Object.fromEntries(this.positionsKeys),ticks:this.ticks},null,4))},e}();exports.INIT_KEY=Ne,exports.MAX_ACCOUNT_POSITION_LENGTH=oe,exports.MAX_PRICE=he,exports.MAX_SQRT_PRICE=we,exports.MAX_TICK=443632,exports.MIN_PRICE=ye,exports.MIN_SQRT_PRICE=me,exports.MIN_TICK=-443632,exports.PIECES=fe,exports.POSITIONS_ACCOUNT_SIZE=36e4,exports.PRICE_OFFSET=de,exports.PositionLayout=re,exports.PositionsAccountLayout=ie,exports.TICKS_ACCOUNT_SIZE=504e3,exports.TOKEN_SWAP_ACCOUNT_SIZE=ce,exports.TickLayout=$,exports.TicksAccountLayout=ee,exports.TokenSwap=_e,exports.TokenSwapAccountLayout=se,exports.calculateLiquity=Ke,exports.calculateLiquityOnlyA=De,exports.calculateLiquityOnlyB=qe,exports.calculateLiquityTable=function(e){for(var t=new n(0),r=new n(0),i=[],o={lowerTick:0,upperTick:0,amount:new n(0)},a=0;a<e.length;a++)o.amount.equals(0)?(o.lowerTick=e[a].tick,o.amount=e[a].liquityNet):(o.upperTick=e[a].tick,t=o.amount.lessThan(t)||t.equals(0)?o.amount:t,r=o.amount.greaterThan(r)?o.amount:r,i.push({lowerTick:o.lowerTick,upperTick:o.upperTick,amount:o.amount}),o.amount=o.amount.add(e[a].liquityNet),o.lowerTick=e[a].tick);return{maxLiquity:r,minLiquity:t,liquitys:i}},exports.calculateSwapA2B=Te,exports.calculateSwapB2A=Ie,exports.calculateTokenAmount=Be,exports.createAssociatedTokenAccountInstruction=N,exports.decimal128=P,exports.decimal64=function(e,t){void 0===e&&(e="uint64"),void 0===t&&(t=0);var n=i.blob(8,e),r=n,o=n.decode.bind(n),a=n.encode.bind(n);return r.decode=function(e,n){var r=Buffer.from(o(e,n));return T.from64Buffer(r,t)},r.encode=function(e,n,r){var i=T.to64Buffer(e,t);return a(i,n,r)},r},exports.decimalU128=O,exports.decimalU64=x,exports.encodeDecode=I,exports.getAssociatedTokenAddress=D,exports.getNearestTick=function(e,t,n){return ve(e,t)},exports.getNearestTickByPrice=Se,exports.getNearestTickBySqrtPrice=ve,exports.getTokenAccount=function(e,t){return _.apply(this,arguments)},exports.getTokenAccounts=L,exports.int128=function(e){return void 0===e&&(e="uint128"),i.blob(16,e)},exports.int64=function(e){return void 0===e&&(e="uint128"),i.blob(8,e)},exports.isPositionsAccount=ae,exports.isTicksAccount=te,exports.isTokenSwapAccount=le,exports.maxAmountA=Ae,exports.maxAmountB=xe,exports.parsePositionsAccount=ue,exports.parseTicksAccount=ne,exports.parseTokenAccount=W,exports.parseTokenAccountData=function(e){var t=u.AccountLayout.decode(e);return t.mint=new o.PublicKey(t.mint),t.owner=new o.PublicKey(t.owner),t.amount=u.u64.fromBuffer(t.amount),0===t.delegateOption?(t.delegate=null,t.delegatedAmount=new u.u64(0)):(t.delegate=new o.PublicKey(t.delegate),t.delegatedAmount=u.u64.fromBuffer(t.delegatedAmount)),t.isInitialized=0!==t.state,t.isFrozen=2===t.state,1===t.isNativeOption?(t.rentExemptReserve=u.u64.fromBuffer(t.isNative),t.isNative=!0):(t.rentExemptReserve=null,t.isNative=!1),t.closeAuthority=0===t.closeAuthorityOption?null:new o.PublicKey(t.closeAuthority),t},exports.parseTokenSwapAccount=pe,exports.price2Tick=ge,exports.publicKey=A,exports.sendAndConfirmTransaction=K,exports.sqrtPrice2Tick=ke,exports.swapA2B=Pe,exports.swapB2A=Oe,exports.tick2Price=function(e){return e>=-443632&&e<=443632||r(!1),fe.pow(e)},exports.tick2SqrtPrice=be,exports.uint128=function(e){return void 0===e&&(e="uint128"),i.blob(16,e)},exports.uint64=function(e){return void 0===e&&(e="uint128"),i.blob(8,e)};
//# sourceMappingURL=crema-sdk.cjs.production.min.js.map
