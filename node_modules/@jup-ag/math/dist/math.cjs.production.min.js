"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("jsbi"),e=require("decimal.js");function u(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=u(t),i=u(e);function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var u=0,r=new Array(e);u<e;u++)r[u]=t[u];return r}function n(t,e){var u="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(u)return(u=u.call(t)).next.bind(u);if(Array.isArray(t)||(u=function(t,e){if(t){if("string"==typeof t)return a(t,e);var u=Object.prototype.toString.call(t).slice(8,-1);return"Object"===u&&t.constructor&&(u=t.constructor.name),"Map"===u||"Set"===u?Array.from(t):"Arguments"===u||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){u&&(t=u);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d=r.default.BigInt(0),l=r.default.BigInt(1),o=r.default.BigInt(2);function f(t){return r.default.GE(t,d)?t:r.default.unaryMinus(t)}function s(t){return t.reduce((function(t,e){return r.default.add(t,e)}),d)}function c(t){return t.reduce((function(t,e){return r.default.multiply(t,e)}),l)}function p(t,e){var u=r.default.divide(t,e);if(r.default.equal(u,d))return[d,d];var i=r.default.remainder(t,e);return r.default.greaterThan(i,d)&&(u=r.default.add(u,l),e=r.default.divide(t,u),i=r.default.remainder(t,u),r.default.greaterThan(i,d)&&(e=r.default.add(e,l))),[u,e]}function m(t,e){return void 0===e&&(e=0),new i.default(t.toString()).div(new i.default(10).pow(e))}var h=function(){function t(t,e,u){this.numberOfCurrencies=void 0,this.amplificationFactor=void 0,this.targetPrices=void 0,this.numberOfCurrencies=t,this.amplificationFactor=e,this.targetPrices=u}var e=t.prototype;return e.exchange=function(t,e,u,i,a){if(void 0===a&&(a=!0),t.length!==r.default.toNumber(this.numberOfCurrencies))throw new Error("Number of currencies does not match");var n=this.xp(t),d=r.default.multiply(i,this.targetPrices[e]),o=r.default.add(n[e],d),f=this.computeY(t,e,u,o),s=r.default.subtract(n[u],f);return a&&(s=r.default.subtract(s,l)),r.default.divide(s,this.targetPrices[u])},e.computeBaseY=function(t,e,u,a){var n=this.computeD(t),d=this.xp(t),l=r.default.exponentiate(this.numberOfCurrencies,this.numberOfCurrencies),o=s(d),f=c(d),p=r.default.subtract(r.default.add(r.default.multiply(r.default.multiply(this.amplificationFactor,l),o),n),r.default.multiply(r.default.multiply(this.amplificationFactor,n),l)),m=r.default.multiply(r.default.multiply(r.default.multiply(this.amplificationFactor,l),l),f),h=r.default.multiply(r.default.multiply(l,f),p),g=r.default.add(m,r.default.divide(h,d[e])),v=r.default.add(m,r.default.divide(h,d[u])),y=Math.log10(r.default.toNumber(this.targetPrices[e])),b=Math.log10(r.default.toNumber(this.targetPrices[u])),O=Math.abs(b-y);return r.default.BigInt(y>=b?new i.default(g.toString()).mul(new i.default(a.toString())).div(new i.default(v.toString())).mul(Math.pow(10,O)).floor().toString():new i.default(g.toString()).mul(new i.default(a.toString())).div(new i.default(v.toString())).div(Math.pow(10,O)).floor().toString())},e.computeY=function(t,e,u,i){var a=this.computeD(t),c=this.xp(t);c[e]=i,c.splice(u,1);for(var p,m=r.default.multiply(this.amplificationFactor,this.numberOfCurrencies),h=a,g=n(c);!(p=g()).done;){var v=p.value;h=r.default.divide(r.default.multiply(h,a),r.default.multiply(v,this.numberOfCurrencies))}h=r.default.divide(r.default.multiply(h,a),r.default.multiply(this.numberOfCurrencies,m));for(var y=r.default.subtract(r.default.add(s(c),r.default.divide(a,m)),a),b=d,O=a;r.default.greaterThan(f(r.default.subtract(O,b)),l);)b=O,O=r.default.divide(r.default.add(r.default.exponentiate(O,o),h),r.default.add(r.default.multiply(o,O),y));return O},e.computeD=function(t){for(var e=d,u=this.xp(t),i=s(u),a=i,o=r.default.multiply(this.amplificationFactor,this.numberOfCurrencies);r.default.greaterThan(f(r.default.subtract(a,e)),l);){for(var c,p=a,m=n(u);!(c=m()).done;){var h=c.value;p=r.default.divide(r.default.multiply(p,a),r.default.multiply(this.numberOfCurrencies,h))}e=a;var g=r.default.multiply(r.default.add(r.default.multiply(o,i),r.default.multiply(p,this.numberOfCurrencies)),a),v=r.default.add(r.default.multiply(r.default.subtract(o,l),a),r.default.multiply(r.default.add(this.numberOfCurrencies,l),p));a=r.default.divide(g,v)}return a},e.xp=function(t){var e=this;return t.map((function(t,u){return r.default.multiply(t,e.targetPrices[u])}))},t}(),g=function(){function t(t,e,u,r){this.targetPrices=void 0,this.traderFee=void 0,this.curve=void 0,this.targetPrices=u,this.traderFee=r,this.curve=new h(t,e,this.targetPrices)}var e=t.prototype;return e.exchange=function(t,e,u,i){var a=this.getOutputAmount(t,e,u,i),n=this.getFees(a),d=r.default.subtract(a,n);return{priceImpact:this.getPriceImpact(t,e,d,u,i),fees:n,expectedOutputAmount:d}},e.getPriceImpact=function(t,e,u,a,n){if(r.default.equal(e,d)||r.default.equal(t[a],d)||r.default.equal(t[n],d))return new i.default(0);var l=m(this.getOutputAmountWithNoSlippage(t,e,a,n)),o=m(u);return l.sub(o).div(l)},e.getFees=function(t){return r.default.equal(this.traderFee.numerator,d)?d:r.default.divide(r.default.multiply(t,this.traderFee.numerator),this.traderFee.denominator)},e.getOutputAmount=function(t,e,u,r){return this.curve.exchange(t,u,r,e)},e.getOutputAmountWithNoSlippage=function(t,e,u,r){return this.curve.computeBaseY(t,u,r,e)},t}();function v(t,e){if(r.default.equal(e.numerator,d)||r.default.equal(t,d))return d;var u=r.default.divide(r.default.multiply(t,e.numerator),e.denominator);return r.default.equal(u,d)?l:u}var y=function(){function t(t,e,u){this.traderFee=void 0,this.ownerFee=void 0,this.curve=void 0,this.traderFee=e,this.ownerFee=u,this.curve=new h(o,t,[l,l])}var e=t.prototype;return e.exchange=function(t,e,u){var r=0===u?1:0,i=this.getExpectedOutputAmount(t,e,r,u);return{priceImpact:this.getPriceImpact(t,e,i,r,u),fees:this.getFees(e),expectedOutputAmount:i}},e.getPriceImpact=function(t,e,u,a,n){if(r.default.equal(e,d)||r.default.equal(t[a],d)||r.default.equal(t[n],d))return new i.default(0);var l=m(this.getExpectedOutputAmountWithNoSlippage(t,e,a,n)),o=m(u);return l.sub(o).div(l)},e.getFees=function(t){var e=v(t,this.traderFee),u=v(t,this.ownerFee);return r.default.add(e,u)},e.getExpectedOutputAmount=function(t,e,u,r){var i=this.getInputAmountLessFees(e);return this.getOutputAmount(t,i,u,r)},e.getExpectedOutputAmountWithNoSlippage=function(t,e,u,r){var i=this.getInputAmountLessFees(e);return this.getOutputAmountWithNoSlippage(t,i,u,r)},e.getInputAmountLessFees=function(t){return r.default.subtract(t,this.getFees(t))},e.getOutputAmount=function(t,e,u,r){return this.curve.exchange(t,u,r,e,!1)},e.getOutputAmountWithNoSlippage=function(t,e,u,r){return this.curve.computeBaseY(t,u,r,e)},t}(),b=function(){function t(t,e,u){void 0===u&&(u=!0),this.traderFee=void 0,this.ownerFee=void 0,this.feesOnInput=void 0,this.traderFee=t,this.ownerFee=e,this.feesOnInput=u}var e=t.prototype;return e.exchange=function(t,e,u){var r=0===u?1:0,i=this.feesOnInput?this.getAmountLessFees(e):e,a=this.getExpectedOutputAmount(t,i,r,u),n=this.getFees(this.feesOnInput?e:a);return this.feesOnInput||(a=this.getAmountLessFees(a)),{priceImpact:this.getPriceImpact(t,i,a,r,u),fees:n,expectedOutputAmount:a}},e.getPriceImpact=function(t,e,u,a,n){if(r.default.equal(e,d)||r.default.equal(t[a],d)||r.default.equal(t[n],d))return new i.default(0);var l=m(this.getExpectedOutputAmountWithNoSlippage(t,e,a,n)),o=m(u);return l.sub(o).div(l)},e.getFees=function(t){var e=v(t,this.traderFee),u=v(t,this.ownerFee);return r.default.add(e,u)},e.getExpectedOutputAmount=function(t,e,u,r){return this.getOutputAmount(t,e,u,r)},e.getExpectedOutputAmountWithNoSlippage=function(t,e,u,i){if(r.default.equal(t[u],d))return t[i];var a=r.default.divide(r.default.multiply(e,t[i]),t[u]);return this.feesOnInput?a:this.getAmountLessFees(a)},e.getAmountLessFees=function(t){return r.default.subtract(t,this.getFees(t))},e.getOutputAmount=function(t,e,u,i){var a=[t[u],t[i]],n=a[0],d=a[1],l=p(this.getInvariant(t),r.default.add(n,e));return r.default.subtract(d,l[0])},e.getInvariant=function(t){return r.default.multiply(t[0],t[1])},t}(),O=function(t,e){this.numerator=void 0,this.denominator=void 0,this.numerator=t,this.denominator=e},F=new O(r.default.BigInt(0),r.default.BigInt(1));exports.Fraction=O,exports.ONE=l,exports.Stable=g,exports.TWO=o,exports.TokenSwapConstantProduct=b,exports.TokenSwapStable=y,exports.ZERO=d,exports.ZERO_FRACTION=F,exports.abs=f,exports.calculateFeeAmount=v,exports.ceilingDivision=p,exports.mulArray=c,exports.sumArray=s,exports.toDecimal=m;
//# sourceMappingURL=math.cjs.production.min.js.map
