{"version":3,"file":"math.cjs.development.js","sources":["../src/utils.ts","../src/math/curve.ts","../src/amm/stable.ts","../src/amm/fees.ts","../src/amm/tokenswap-stable.ts","../src/amm/tokenswap-constant-product.ts","../src/fraction.ts"],"sourcesContent":["import JSBI from 'jsbi';\nimport Decimal from 'decimal.js';\n\nexport type SwapResult = {\n  priceImpact: Decimal;\n  fees: JSBI;\n  expectedOutputAmount: JSBI;\n};\n\nexport const ZERO = JSBI.BigInt(0);\nexport const ONE = JSBI.BigInt(1);\nexport const TWO = JSBI.BigInt(2);\n\nexport function abs(number: JSBI) {\n  if (JSBI.GE(number, ZERO)) {\n    return number;\n  }\n\n  return JSBI.unaryMinus(number);\n}\n\nexport function sumArray(numbers: JSBI[]) {\n  return numbers.reduce((prev, curr) => {\n    return JSBI.add(prev, curr);\n  }, ZERO);\n}\n\nexport function mulArray(numbers: JSBI[]) {\n  return numbers.reduce((prev, curr) => {\n    return JSBI.multiply(prev, curr);\n  }, ONE);\n}\n\nexport function ceilingDivision(dividend: JSBI, divisor: JSBI): [JSBI, JSBI] {\n  let quotient = JSBI.divide(dividend, divisor);\n  if (JSBI.equal(quotient, ZERO)) {\n    return [ZERO, ZERO];\n  }\n\n  let remainder = JSBI.remainder(dividend, divisor);\n  if (JSBI.greaterThan(remainder, ZERO)) {\n    quotient = JSBI.add(quotient, ONE);\n    divisor = JSBI.divide(dividend, quotient);\n    remainder = JSBI.remainder(dividend, quotient);\n    if (JSBI.greaterThan(remainder, ZERO)) {\n      divisor = JSBI.add(divisor, ONE);\n    }\n  }\n\n  return [quotient, divisor];\n}\n\nexport function toDecimal(input: JSBI, shift = 0) {\n  return new Decimal(input.toString()).div(new Decimal(10).pow(shift));\n}\n","import JSBI from 'jsbi';\nimport { abs, mulArray, ONE, sumArray, TWO, ZERO } from '../utils';\nimport Decimal from 'decimal.js';\n\nexport class Curve {\n  constructor(private numberOfCurrencies: JSBI, private amplificationFactor: JSBI, private targetPrices: JSBI[]) {}\n\n  public exchange(\n    tokenAmounts: JSBI[],\n    inputIndex: number,\n    outputIndex: number,\n    amount: JSBI,\n    minusOne: boolean = true,\n  ) {\n    if (tokenAmounts.length !== JSBI.toNumber(this.numberOfCurrencies)) {\n      throw new Error('Number of currencies does not match');\n    }\n\n    let xp = this.xp(tokenAmounts);\n    let dx = JSBI.multiply(amount, this.targetPrices[inputIndex]);\n    let x = JSBI.add(xp[inputIndex], dx);\n    let y = this.computeY(tokenAmounts, inputIndex, outputIndex, x);\n    let dy = JSBI.subtract(xp[outputIndex], y);\n\n    // This is a special condition on Curve stable algo. For TokenSwap, they don't seem to apply this minus one.\n    if (minusOne) {\n      dy = JSBI.subtract(dy, ONE);\n    }\n\n    return JSBI.divide(dy, this.targetPrices[outputIndex]);\n  }\n\n  public computeBaseY(tokenAmounts: JSBI[], inputIndex: number, outputIndex: number, amount: JSBI) {\n    let d = this.computeD(tokenAmounts);\n    let xp = this.xp(tokenAmounts);\n    let nn = JSBI.exponentiate(this.numberOfCurrencies, this.numberOfCurrencies);\n    let sum = sumArray(xp);\n    let product = mulArray(xp);\n    let k = JSBI.subtract(\n      JSBI.add(JSBI.multiply(JSBI.multiply(this.amplificationFactor, nn), sum), d),\n      JSBI.multiply(JSBI.multiply(this.amplificationFactor, d), nn),\n    );\n    let b = JSBI.multiply(JSBI.multiply(JSBI.multiply(this.amplificationFactor, nn), nn), product);\n    let c = JSBI.multiply(JSBI.multiply(nn, product), k);\n    let numerator = JSBI.add(b, JSBI.divide(c, xp[inputIndex]));\n    let denominator = JSBI.add(b, JSBI.divide(c, xp[outputIndex]));\n\n    // Convert to number since JSBI doesn't support log10\n    let inputFactor = Math.log10(JSBI.toNumber(this.targetPrices[inputIndex]));\n    let outputFactor = Math.log10(JSBI.toNumber(this.targetPrices[outputIndex]));\n    let factor = Math.abs(outputFactor - inputFactor);\n\n    if (inputFactor >= outputFactor) {\n      return JSBI.BigInt(\n        new Decimal(numerator.toString())\n          .mul(new Decimal(amount.toString()))\n          .div(new Decimal(denominator.toString()))\n          .mul(Math.pow(10, factor))\n          .floor()\n          .toString(),\n      );\n    } else {\n      return JSBI.BigInt(\n        new Decimal(numerator.toString())\n          .mul(new Decimal(amount.toString()))\n          .div(new Decimal(denominator.toString()))\n          .div(Math.pow(10, factor))\n          .floor()\n          .toString(),\n      );\n    }\n  }\n\n  private computeY(tokenAmounts: JSBI[], inputIndex: number, outputIndex: number, newTotalAmount: JSBI) {\n    let d = this.computeD(tokenAmounts);\n    let xx = this.xp(tokenAmounts);\n    xx[inputIndex] = newTotalAmount;\n    xx.splice(outputIndex, 1);\n\n    let ann = JSBI.multiply(this.amplificationFactor, this.numberOfCurrencies);\n    let c = d;\n\n    for (const y of xx) {\n      c = JSBI.divide(JSBI.multiply(c, d), JSBI.multiply(y, this.numberOfCurrencies));\n    }\n    c = JSBI.divide(JSBI.multiply(c, d), JSBI.multiply(this.numberOfCurrencies, ann));\n\n    let b = JSBI.subtract(JSBI.add(sumArray(xx), JSBI.divide(d, ann)), d);\n    let yPrev = ZERO;\n    let y = d;\n\n    while (JSBI.greaterThan(abs(JSBI.subtract(y, yPrev)), ONE)) {\n      yPrev = y;\n      y = JSBI.divide(JSBI.add(JSBI.exponentiate(y, TWO), c), JSBI.add(JSBI.multiply(TWO, y), b));\n    }\n\n    return y;\n  }\n\n  private computeD(tokenAmounts: JSBI[]) {\n    let dPrev = ZERO;\n    let xp = this.xp(tokenAmounts);\n    let sum = sumArray(xp);\n    let d = sum;\n    let ann = JSBI.multiply(this.amplificationFactor, this.numberOfCurrencies);\n\n    while (JSBI.greaterThan(abs(JSBI.subtract(d, dPrev)), ONE)) {\n      let dP = d;\n      for (const x of xp) {\n        dP = JSBI.divide(JSBI.multiply(dP, d), JSBI.multiply(this.numberOfCurrencies, x));\n      }\n      dPrev = d;\n      let numerator = JSBI.multiply(JSBI.add(JSBI.multiply(ann, sum), JSBI.multiply(dP, this.numberOfCurrencies)), d);\n      let denominator = JSBI.add(\n        JSBI.multiply(JSBI.subtract(ann, ONE), d),\n        JSBI.multiply(JSBI.add(this.numberOfCurrencies, ONE), dP),\n      );\n      d = JSBI.divide(numerator, denominator);\n    }\n\n    return d;\n  }\n\n  private xp(tokenAmounts: JSBI[]) {\n    return tokenAmounts.map((tokenAmount, index) => {\n      return JSBI.multiply(tokenAmount, this.targetPrices[index]);\n    });\n  }\n}\n","import JSBI from 'jsbi';\nimport { Curve } from '../math/curve';\nimport { SwapResult, toDecimal, ZERO } from '../utils';\nimport Decimal from 'decimal.js';\nimport { Fraction } from '..';\n\nexport class Stable {\n  private curve: Curve;\n\n  constructor(numberOfCurrencies: JSBI, amp: JSBI, private targetPrices: JSBI[], private traderFee: Fraction) {\n    this.curve = new Curve(numberOfCurrencies, amp, this.targetPrices);\n  }\n\n  public exchange(tokenAmounts: JSBI[], inputTradeAmount: JSBI, inputIndex: number, outputIndex: number): SwapResult {\n    let outputAmountWithoutFees = this.getOutputAmount(tokenAmounts, inputTradeAmount, inputIndex, outputIndex);\n    let fees = this.getFees(outputAmountWithoutFees);\n    let expectedOutputAmount = JSBI.subtract(outputAmountWithoutFees, fees);\n\n    return {\n      priceImpact: this.getPriceImpact(tokenAmounts, inputTradeAmount, expectedOutputAmount, inputIndex, outputIndex),\n      fees: fees,\n      expectedOutputAmount: expectedOutputAmount,\n    };\n  }\n\n  private getPriceImpact(\n    tokenAmounts: JSBI[],\n    inputTradeAmountJSBI: JSBI,\n    expectedOutputAmountJSBI: JSBI,\n    inputIndex: number,\n    outputIndex: number,\n  ): Decimal {\n    if (\n      JSBI.equal(inputTradeAmountJSBI, ZERO) ||\n      JSBI.equal(tokenAmounts[inputIndex], ZERO) ||\n      JSBI.equal(tokenAmounts[outputIndex], ZERO)\n    ) {\n      return new Decimal(0);\n    }\n\n    const noSlippageOutputAmount = toDecimal(\n      this.getOutputAmountWithNoSlippage(tokenAmounts, inputTradeAmountJSBI, inputIndex, outputIndex),\n    );\n    const expectedOutputAmount = toDecimal(expectedOutputAmountJSBI);\n    const impact = noSlippageOutputAmount.sub(expectedOutputAmount).div(noSlippageOutputAmount);\n\n    return impact;\n  }\n\n  private getFees(outputAmountWithoutFees: JSBI): JSBI {\n    return JSBI.equal(this.traderFee.numerator, ZERO)\n      ? ZERO\n      : JSBI.divide(JSBI.multiply(outputAmountWithoutFees, this.traderFee.numerator), this.traderFee.denominator);\n  }\n\n  private getOutputAmount(tokenAmounts: JSBI[], inputTradeAmount: JSBI, inputIndex: number, outputIndex: number): JSBI {\n    return this.curve.exchange(tokenAmounts, inputIndex, outputIndex, inputTradeAmount);\n  }\n\n  private getOutputAmountWithNoSlippage(\n    tokenAmounts: JSBI[],\n    inputTradeAmount: JSBI,\n    inputIndex: number,\n    outputIndex: number,\n  ): JSBI {\n    return this.curve.computeBaseY(tokenAmounts, inputIndex, outputIndex, inputTradeAmount);\n  }\n}\n","import JSBI from 'jsbi';\nimport { Fraction } from '../fraction';\nimport { ZERO, ONE } from '../utils';\n\n/** calculates fee amount given a fee fraction, returning one when fee is set but amount is zero */\nexport function calculateFeeAmount(amount: JSBI, fee: Fraction): JSBI {\n  if (JSBI.equal(fee.numerator, ZERO) || JSBI.equal(amount, ZERO)) {\n    return ZERO;\n  } else {\n    const feeAmount = JSBI.divide(JSBI.multiply(amount, fee.numerator), fee.denominator);\n    if (JSBI.equal(feeAmount, ZERO)) {\n      return ONE;\n    }\n    return feeAmount;\n  }\n}\n","import JSBI from 'jsbi';\nimport { Curve } from '../math/curve';\nimport { ONE, SwapResult, toDecimal, ZERO, TWO } from '../utils';\nimport Decimal from 'decimal.js';\nimport { Fraction } from '../fraction';\nimport { calculateFeeAmount } from './fees';\n\nexport class TokenSwapStable {\n  private curve: Curve;\n\n  constructor(amp: JSBI, private traderFee: Fraction, private ownerFee: Fraction) {\n    this.curve = new Curve(TWO, amp, [ONE, ONE]);\n  }\n\n  public exchange(tokenAmounts: JSBI[], inputTradeAmount: JSBI, outputIndex: number): SwapResult {\n    let inputIndex = outputIndex === 0 ? 1 : 0;\n    let expectedOutputAmount = this.getExpectedOutputAmount(tokenAmounts, inputTradeAmount, inputIndex, outputIndex);\n\n    return {\n      priceImpact: this.getPriceImpact(tokenAmounts, inputTradeAmount, expectedOutputAmount, inputIndex, outputIndex),\n      fees: this.getFees(inputTradeAmount),\n      expectedOutputAmount,\n    };\n  }\n\n  private getPriceImpact(\n    tokenAmounts: JSBI[],\n    inputTradeAmountJSBI: JSBI,\n    expectedOutputAmountJSBI: JSBI,\n    inputIndex: number,\n    outputIndex: number,\n  ): Decimal {\n    if (\n      JSBI.equal(inputTradeAmountJSBI, ZERO) ||\n      JSBI.equal(tokenAmounts[inputIndex], ZERO) ||\n      JSBI.equal(tokenAmounts[outputIndex], ZERO)\n    ) {\n      return new Decimal(0);\n    }\n\n    const noSlippageOutputAmount = toDecimal(\n      this.getExpectedOutputAmountWithNoSlippage(tokenAmounts, inputTradeAmountJSBI, inputIndex, outputIndex),\n    );\n\n    const expectedOutputAmount = toDecimal(expectedOutputAmountJSBI);\n    const impact = noSlippageOutputAmount.sub(expectedOutputAmount).div(noSlippageOutputAmount);\n\n    return impact;\n  }\n\n  private getFees(inputTradeAmount: JSBI): JSBI {\n    const tradingFee = calculateFeeAmount(inputTradeAmount, this.traderFee);\n    const ownerFee = calculateFeeAmount(inputTradeAmount, this.ownerFee);\n\n    return JSBI.add(tradingFee, ownerFee);\n  }\n\n  private getExpectedOutputAmount(\n    tokenAmounts: JSBI[],\n    inputTradeAmount: JSBI,\n    inputIndex: number,\n    outputIndex: number,\n  ): JSBI {\n    const inputTradeAmountLessFees = this.getInputAmountLessFees(inputTradeAmount);\n\n    return this.getOutputAmount(tokenAmounts, inputTradeAmountLessFees, inputIndex, outputIndex);\n  }\n\n  private getExpectedOutputAmountWithNoSlippage(\n    tokenAmounts: JSBI[],\n    inputTradeAmount: JSBI,\n    inputIndex: number,\n    outputIndex: number,\n  ): JSBI {\n    const inputTradeAmountLessFees = this.getInputAmountLessFees(inputTradeAmount);\n\n    return this.getOutputAmountWithNoSlippage(tokenAmounts, inputTradeAmountLessFees, inputIndex, outputIndex);\n  }\n\n  private getInputAmountLessFees(inputTradeAmount: JSBI): JSBI {\n    return JSBI.subtract(inputTradeAmount, this.getFees(inputTradeAmount));\n  }\n\n  private getOutputAmount(\n    tokenAmounts: JSBI[],\n    inputTradeAmountLessFees: JSBI,\n    inputIndex: number,\n    outputIndex: number,\n  ): JSBI {\n    return this.curve.exchange(tokenAmounts, inputIndex, outputIndex, inputTradeAmountLessFees, false);\n  }\n\n  private getOutputAmountWithNoSlippage(\n    tokenAmounts: JSBI[],\n    inputTradeAmountLessFees: JSBI,\n    inputIndex: number,\n    outputIndex: number,\n  ): JSBI {\n    return this.curve.computeBaseY(tokenAmounts, inputIndex, outputIndex, inputTradeAmountLessFees);\n  }\n}\n","import JSBI from 'jsbi';\nimport { SwapResult, toDecimal, ZERO, ceilingDivision } from '../utils';\nimport Decimal from 'decimal.js';\nimport { Fraction } from '..';\nimport { calculateFeeAmount } from './fees';\n\nexport class TokenSwapConstantProduct {\n  constructor(private traderFee: Fraction, private ownerFee: Fraction, private feesOnInput: boolean = true) {}\n\n  public exchange(tokenAmounts: JSBI[], inputTradeAmount: JSBI, outputIndex: number): SwapResult {\n    let inputIndex = outputIndex === 0 ? 1 : 0;\n    const newInputTradeAmount = this.feesOnInput ? this.getAmountLessFees(inputTradeAmount) : inputTradeAmount;\n\n    let expectedOutputAmount = this.getExpectedOutputAmount(tokenAmounts, newInputTradeAmount, inputIndex, outputIndex);\n\n    let fees = this.getFees(this.feesOnInput ? inputTradeAmount : expectedOutputAmount);\n\n    if (!this.feesOnInput) {\n      expectedOutputAmount = this.getAmountLessFees(expectedOutputAmount);\n    }\n\n    return {\n      priceImpact: this.getPriceImpact(\n        tokenAmounts,\n        newInputTradeAmount,\n        expectedOutputAmount,\n        inputIndex,\n        outputIndex,\n      ),\n      fees,\n      expectedOutputAmount,\n    };\n  }\n\n  private getPriceImpact(\n    tokenAmounts: JSBI[],\n    inputTradeAmountJSBI: JSBI,\n    expectedOutputAmountJSBI: JSBI,\n    inputIndex: number,\n    outputIndex: number,\n  ): Decimal {\n    if (\n      JSBI.equal(inputTradeAmountJSBI, ZERO) ||\n      JSBI.equal(tokenAmounts[inputIndex], ZERO) ||\n      JSBI.equal(tokenAmounts[outputIndex], ZERO)\n    ) {\n      return new Decimal(0);\n    }\n\n    const noSlippageOutputAmount = toDecimal(\n      this.getExpectedOutputAmountWithNoSlippage(tokenAmounts, inputTradeAmountJSBI, inputIndex, outputIndex),\n    );\n    const expectedOutputAmount = toDecimal(expectedOutputAmountJSBI);\n    const impact = noSlippageOutputAmount.sub(expectedOutputAmount).div(noSlippageOutputAmount);\n\n    return impact;\n  }\n\n  private getFees(inputTradeAmount: JSBI): JSBI {\n    const tradingFee = calculateFeeAmount(inputTradeAmount, this.traderFee);\n    const ownerFee = calculateFeeAmount(inputTradeAmount, this.ownerFee);\n\n    return JSBI.add(tradingFee, ownerFee);\n  }\n\n  private getExpectedOutputAmount(\n    tokenAmounts: JSBI[],\n    inputTradeAmount: JSBI,\n    inputIndex: number,\n    outputIndex: number,\n  ): JSBI {\n    return this.getOutputAmount(tokenAmounts, inputTradeAmount, inputIndex, outputIndex);\n  }\n\n  private getExpectedOutputAmountWithNoSlippage(\n    tokenAmounts: JSBI[],\n    inputTradeAmount: JSBI,\n    inputIndex: number,\n    outputIndex: number,\n  ): JSBI {\n    if (JSBI.equal(tokenAmounts[inputIndex], ZERO)) {\n      return tokenAmounts[outputIndex];\n    }\n\n    let expectedOutputAmountWithNoSlippage = JSBI.divide(\n      JSBI.multiply(inputTradeAmount, tokenAmounts[outputIndex]),\n      tokenAmounts[inputIndex],\n    );\n\n    if (this.feesOnInput) {\n      return expectedOutputAmountWithNoSlippage;\n    } else {\n      return this.getAmountLessFees(expectedOutputAmountWithNoSlippage);\n    }\n  }\n\n  private getAmountLessFees(tradeAmount: JSBI): JSBI {\n    return JSBI.subtract(tradeAmount, this.getFees(tradeAmount));\n  }\n\n  private getOutputAmount(tokenAmounts: JSBI[], inputTradeAmount: JSBI, inputIndex: number, outputIndex: number): JSBI {\n    const [poolInputAmount, poolOutputAmount] = [tokenAmounts[inputIndex], tokenAmounts[outputIndex]];\n\n    const invariant = this.getInvariant(tokenAmounts);\n\n    const [newPoolOutputAmount] = ceilingDivision(invariant, JSBI.add(poolInputAmount, inputTradeAmount));\n\n    return JSBI.subtract(poolOutputAmount, newPoolOutputAmount);\n  }\n\n  getInvariant(tokenAmounts: JSBI[]) {\n    return JSBI.multiply(tokenAmounts[0], tokenAmounts[1]);\n  }\n}\n","import JSBI from 'jsbi';\n\nexport class Fraction {\n  constructor(public numerator: JSBI, public denominator: JSBI) {}\n}\n\nexport const ZERO_FRACTION = new Fraction(JSBI.BigInt(0), JSBI.BigInt(1));\n"],"names":["ZERO","JSBI","BigInt","ONE","TWO","abs","number","GE","unaryMinus","sumArray","numbers","reduce","prev","curr","add","mulArray","multiply","ceilingDivision","dividend","divisor","quotient","divide","equal","remainder","greaterThan","toDecimal","input","shift","Decimal","toString","div","pow","Curve","numberOfCurrencies","amplificationFactor","targetPrices","exchange","tokenAmounts","inputIndex","outputIndex","amount","minusOne","length","toNumber","Error","xp","dx","x","y","computeY","dy","subtract","computeBaseY","d","computeD","nn","exponentiate","sum","product","k","b","c","numerator","denominator","inputFactor","Math","log10","outputFactor","factor","mul","floor","newTotalAmount","xx","splice","ann","yPrev","dPrev","dP","map","tokenAmount","index","Stable","amp","traderFee","curve","inputTradeAmount","outputAmountWithoutFees","getOutputAmount","fees","getFees","expectedOutputAmount","priceImpact","getPriceImpact","inputTradeAmountJSBI","expectedOutputAmountJSBI","noSlippageOutputAmount","getOutputAmountWithNoSlippage","impact","sub","calculateFeeAmount","fee","feeAmount","TokenSwapStable","ownerFee","getExpectedOutputAmount","getExpectedOutputAmountWithNoSlippage","tradingFee","inputTradeAmountLessFees","getInputAmountLessFees","TokenSwapConstantProduct","feesOnInput","newInputTradeAmount","getAmountLessFees","expectedOutputAmountWithNoSlippage","tradeAmount","poolInputAmount","poolOutputAmount","invariant","getInvariant","newPoolOutputAmount","Fraction","ZERO_FRACTION"],"mappings":"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"}