"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),core=require("@jup-ag/core");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var React__default=_interopDefaultLegacy(React);const Errors={INITIALIZE_ERROR:"INITIALIZE_ERROR",ROUTES_ERROR:"ROUTES_ERROR"};function useDebounce(t,r){const[e,o]=React.useState(t);return React.useEffect(()=>{const e=setTimeout(()=>{o(t)},r);return()=>{clearTimeout(e)}},[t,r]),e}const JupiterContext=React.createContext(null),JupiterProvider=({connection:t,cluster:r,userPublicKey:o,children:e,platformFeeAndAccounts:u,quoteMintToReferrer:n,routeCacheDuration:c,marketUrl:a,restrictIntermediateTokens:i,onlyDirectRoutes:s})=>{const[R,l]=React.useState(),[p,f]=React.useState(),d=(React.useEffect(()=>{(async()=>{try{var e=await core.Jupiter.load({connection:t,cluster:r,user:o,platformFeeAndAccounts:u,routeCacheDuration:c,quoteMintToReferrer:n,marketUrl:a,restrictIntermediateTokens:i});l(e)}catch(e){throw console.error(e),f(Errors.INITIALIZE_ERROR),e}})()},[t,r,i]),React.useEffect(()=>{R&&o&&R.setUserPublicKey(o)},[R,o]),React.useMemo(()=>{let e=new Map;return e=R?R.getRouteMap(s):e},[R,s]));var E=React.useMemo(()=>Array.from(d.keys()),[d]);return React__default.default.createElement(JupiterContext.Provider,{value:{jupiter:R,allTokenMints:E,connection:t,cluster:r,routeMap:d,error:p,setError:f,routeCacheDuration:c,onlyDirectRoutes:s}},e)},useJupiterRouteMap=()=>{var e=React.useContext(JupiterContext);if(e)return e.routeMap;throw new Error("JupiterProvider is required")},useJupiter=({amount:e,inputMint:t,outputMint:r,slippage:o,debounceTime:u=250})=>{var n=React.useContext(JupiterContext);const[c,a]=React.useState(!1),[i,s]=React.useState(),[R,l]=React.useState(0),p=React.useRef(R),[f,d,E]=useDebounce(React__default.default.useMemo(()=>[e,t,r],[e,null==t?void 0:t.toBase58(),null==r?void 0:r.toBase58()]),u),T=React.useRef(0),I=React.useRef(0);if(!n)throw new Error("JupiterProvider is required");const{routeMap:m,allTokenMints:_,jupiter:v,error:M,setError:w,routeCacheDuration:h=0,onlyDirectRoutes:y}=n;React.useEffect(()=>{p.current=-1},[[null===d||void 0===d?void 0:d.toString(),null===E||void 0===E?void 0:E.toString()].sort().join("-"),o]),React.useEffect(()=>{T.current&&(new Date).getTime()-T.current>=h&&(p.current=-1),f&&R!==p.current&&a(!0)},[R,f,o,d,E,y]),React.useEffect(()=>{if(v)if(f&&M!==Errors.INITIALIZE_ERROR){if(f&&d&&E&&m){let r=(new Date).getTime();I.current=r,v.computeRoutes({inputMint:d,outputMint:E,inputAmount:f,slippage:o,forceFetch:R!==p.current,onlyDirectRoutes:y}).then(({routesInfos:e,cached:t})=>{I.current===r&&(s(e),w(void 0),t||(T.current=(new Date).getTime()))}).catch(e=>{console.error(e),I.current===r&&(s(void 0),w(Errors.ROUTES_ERROR))}).finally(()=>{I.current===r&&(p.current=R,a(!1))})}}else s(void 0)},[v,f,d,E,o,R,y]);u=React.useCallback(async({wallet:e,routeInfo:t,onTransaction:r})=>{if(M)throw new Error(M);if(!v)throw new Error("Jupiter not initialized");if(null==e||!e.publicKey)throw new Error("Wallet not connected");if(!t)throw new Error("Invalid state, impossible to build transaction");const o=(await v.exchange({routeInfo:t}))["execute"];return await o({wallet:e,onTransaction:r})},[v]);return{allTokenMints:_,routeMap:m,exchange:u,refresh:()=>{!c&&T.current&&l(e=>e+1)},lastRefreshTimestamp:T.current,loading:c,routes:i,error:M}};Object.defineProperty(exports,"JUPITER_ERRORS",{enumerable:!0,get:function(){return core.JUPITER_ERRORS}}),Object.defineProperty(exports,"MARKETS_URL",{enumerable:!0,get:function(){return core.MARKETS_URL}}),Object.defineProperty(exports,"TOKEN_LIST_URL",{enumerable:!0,get:function(){return core.TOKEN_LIST_URL}}),Object.defineProperty(exports,"getRouteInfoUniqueId",{enumerable:!0,get:function(){return core.getRouteInfoUniqueId}}),exports.Errors=Errors,exports.JupiterProvider=JupiterProvider,exports.useJupiter=useJupiter,exports.useJupiterRouteMap=useJupiterRouteMap;
//# sourceMappingURL=react-hook.cjs.development.js.map
