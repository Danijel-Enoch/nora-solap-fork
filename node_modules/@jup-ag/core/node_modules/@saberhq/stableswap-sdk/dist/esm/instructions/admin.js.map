{"version":3,"file":"admin.js","sourceRoot":"","sources":["../../../src/instructions/admin.ts"],"names":[],"mappings":"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","sourcesContent":["import type { u64 } from \"@saberhq/token-utils\";\nimport * as BufferLayout from \"@solana/buffer-layout\";\nimport type { PublicKey, TransactionInstruction } from \"@solana/web3.js\";\n\nimport type { StableSwapState } from \"../state\";\nimport type { Fees } from \"../state/fees\";\nimport { encodeFees, ZERO_FEES } from \"../state/fees\";\nimport {\n  ApplyNewAdminIXLayout,\n  PauseIXLayout,\n  RampAIXLayout,\n  SetFeeAccountIXLayout,\n  SetNewFeesIXLayout,\n  StopRampAIXLayout,\n  UnpauseIXLayout,\n} from \".\";\nimport type { StableSwapConfig } from \"./common\";\nimport { buildInstruction } from \"./common\";\n\n/**\n * Admin instruction.\n */\nexport enum AdminInstruction {\n  RAMP_A = 100,\n  STOP_RAMP_A = 101,\n  PAUSE = 102,\n  UNPAUSE = 103,\n  SET_FEE_ACCOUNT = 104,\n  APPLY_NEW_ADMIN = 105,\n  COMMIT_NEW_ADMIN = 106,\n  SET_NEW_FEES = 107,\n}\n\n/**\n * Creates a ramp A instruction.\n */\nexport const createAdminRampAInstruction = ({\n  config,\n  state: { adminAccount },\n  targetAmp,\n  stopRamp,\n}: {\n  config: StableSwapConfig;\n  state: Pick<StableSwapState, \"adminAccount\">;\n  targetAmp: u64;\n  stopRamp: Date;\n}): TransactionInstruction => {\n  const keys = [\n    { pubkey: config.swapAccount, isSigner: false, isWritable: true },\n    { pubkey: adminAccount, isSigner: true, isWritable: false },\n  ];\n  const data = Buffer.alloc(RampAIXLayout.span);\n  RampAIXLayout.encode(\n    {\n      instruction: AdminInstruction.RAMP_A,\n      targetAmp: targetAmp.toBuffer(),\n      stopRampTS: Math.floor(stopRamp.getTime() / 1_000),\n    },\n    data\n  );\n  return buildInstruction({\n    config,\n    keys,\n    data,\n  });\n};\n\n/**\n * Creates a stop ramp A instruction.\n */\nexport const createAdminStopRampAInstruction = ({\n  config,\n  state: { adminAccount },\n}: {\n  config: StableSwapConfig;\n  state: Pick<StableSwapState, \"adminAccount\">;\n}): TransactionInstruction => {\n  const keys = [\n    { pubkey: config.swapAccount, isSigner: false, isWritable: true },\n    { pubkey: adminAccount, isSigner: true, isWritable: false },\n  ];\n  let data = Buffer.alloc(StopRampAIXLayout.span);\n  const encodeLength = StopRampAIXLayout.encode(\n    {\n      instruction: AdminInstruction.STOP_RAMP_A,\n    },\n    data\n  );\n  data = data.slice(0, encodeLength);\n  return buildInstruction({\n    config,\n    keys,\n    data,\n  });\n};\n\n/**\n * Creates a pause instruction.\n */\nexport const createAdminPauseInstruction = ({\n  config,\n  state: { adminAccount },\n}: {\n  config: StableSwapConfig;\n  state: Pick<StableSwapState, \"adminAccount\">;\n}): TransactionInstruction => {\n  const keys = [\n    { pubkey: config.swapAccount, isSigner: false, isWritable: true },\n    { pubkey: adminAccount, isSigner: true, isWritable: false },\n  ];\n  const data = Buffer.alloc(PauseIXLayout.span);\n  PauseIXLayout.encode(\n    {\n      instruction: AdminInstruction.PAUSE,\n    },\n    data\n  );\n  return buildInstruction({\n    config,\n    keys,\n    data,\n  });\n};\n\n/**\n * Creates an unpause instruction.\n */\nexport const createAdminUnpauseInstruction = ({\n  config,\n  state: { adminAccount },\n}: {\n  config: StableSwapConfig;\n  state: Pick<StableSwapState, \"adminAccount\">;\n}): TransactionInstruction => {\n  const keys = [\n    { pubkey: config.swapAccount, isSigner: false, isWritable: true },\n    { pubkey: adminAccount, isSigner: true, isWritable: false },\n  ];\n  const data = Buffer.alloc(UnpauseIXLayout.span);\n  UnpauseIXLayout.encode(\n    {\n      instruction: AdminInstruction.UNPAUSE,\n    },\n    data\n  );\n  return buildInstruction({\n    config,\n    keys,\n    data,\n  });\n};\n\n/**\n * Creates a set fee account instruction.\n */\nexport const createAdminSetFeeAccountInstruction = ({\n  config,\n  state: { adminAccount },\n  tokenAccount,\n}: {\n  config: StableSwapConfig;\n  state: Pick<StableSwapState, \"adminAccount\">;\n  tokenAccount: PublicKey;\n}): TransactionInstruction => {\n  const keys = [\n    { pubkey: config.swapAccount, isSigner: false, isWritable: true },\n    { pubkey: adminAccount, isSigner: true, isWritable: false },\n    { pubkey: tokenAccount, isSigner: false, isWritable: false },\n  ];\n  const data = Buffer.alloc(SetFeeAccountIXLayout.span);\n  SetFeeAccountIXLayout.encode(\n    {\n      instruction: AdminInstruction.SET_FEE_ACCOUNT,\n    },\n    data\n  );\n  return buildInstruction({\n    config,\n    keys,\n    data,\n  });\n};\n\n/**\n * Creates a set new fees instruction.\n */\nexport const createAdminApplyNewAdminInstruction = ({\n  config,\n  state: { adminAccount },\n}: {\n  config: StableSwapConfig;\n  state: Pick<StableSwapState, \"adminAccount\">;\n}): TransactionInstruction => {\n  const keys = [\n    { pubkey: config.swapAccount, isSigner: false, isWritable: true },\n    { pubkey: adminAccount, isSigner: true, isWritable: false },\n  ];\n  const data = Buffer.alloc(ApplyNewAdminIXLayout.span);\n  ApplyNewAdminIXLayout.encode(\n    {\n      instruction: AdminInstruction.APPLY_NEW_ADMIN,\n    },\n    data\n  );\n  return buildInstruction({\n    config,\n    keys,\n    data,\n  });\n};\n\n/**\n * Creates a set new fees instruction.\n */\nexport const createAdminCommitNewAdminInstruction = ({\n  config,\n  state: { adminAccount },\n  newAdminAccount,\n}: {\n  config: StableSwapConfig;\n  state: Pick<StableSwapState, \"adminAccount\">;\n  newAdminAccount: PublicKey;\n}): TransactionInstruction => {\n  const keys = [\n    { pubkey: config.swapAccount, isSigner: false, isWritable: true },\n    { pubkey: adminAccount, isSigner: true, isWritable: false },\n    { pubkey: newAdminAccount, isSigner: false, isWritable: false },\n  ];\n  const dataLayout = BufferLayout.struct<{\n    instruction: number;\n  }>([BufferLayout.u8(\"instruction\")]);\n  const data = Buffer.alloc(dataLayout.span);\n  dataLayout.encode(\n    {\n      instruction: AdminInstruction.COMMIT_NEW_ADMIN,\n    },\n    data\n  );\n  return buildInstruction({\n    config,\n    keys,\n    data,\n  });\n};\n\n/**\n * Creates a set new fees instruction.\n */\nexport const createAdminSetNewFeesInstruction = ({\n  config,\n  state: { adminAccount },\n  fees = ZERO_FEES,\n}: {\n  config: StableSwapConfig;\n  state: Pick<StableSwapState, \"adminAccount\">;\n  fees: Fees;\n}): TransactionInstruction => {\n  const keys = [\n    { pubkey: config.swapAccount, isSigner: false, isWritable: true },\n    { pubkey: adminAccount, isSigner: true, isWritable: false },\n  ];\n  const data = Buffer.alloc(SetNewFeesIXLayout.span);\n  SetNewFeesIXLayout.encode(\n    {\n      instruction: AdminInstruction.SET_NEW_FEES, // InitializeSwap instruction\n      fees: encodeFees(fees),\n    },\n    data\n  );\n  return buildInstruction({\n    config,\n    keys,\n    data,\n  });\n};\n"]}